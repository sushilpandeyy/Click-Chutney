<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClickChutney SPA Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #0A0A0A;
            color: #FAFAFA;
        }
        .header {
            background: #111111;
            border: 1px solid #262626;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        .container {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin: 20px 0;
        }
        .sidebar {
            background: #111111;
            border: 1px solid #262626;
            border-radius: 8px;
            padding: 20px;
        }
        .content {
            background: #111111;
            border: 1px solid #262626;
            border-radius: 8px;
            padding: 20px;
        }
        .nav-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .nav-menu li {
            margin: 8px 0;
        }
        .nav-menu button {
            background: #1A1A1A;
            border: 1px solid #262626;
            color: #FAFAFA;
            padding: 12px 16px;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
            text-align: left;
            transition: all 0.2s;
        }
        .nav-menu button:hover, .nav-menu button.active {
            background: #3B82F6;
            border-color: #3B82F6;
        }
        .status-panel {
            background: #1A1A1A;
            border: 1px solid #262626;
            padding: 16px;
            border-radius: 8px;
            margin: 16px 0;
            font-family: monospace;
            font-size: 0.875rem;
        }
        .status-panel h3 {
            margin-top: 0;
            color: #3B82F6;
        }
        .badge {
            background: #3B82F6;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.875rem;
            font-weight: 500;
            display: inline-block;
            margin: 4px 8px 4px 0;
        }
        .url-input {
            background: #1A1A1A;
            border: 1px solid #262626;
            color: #FAFAFA;
            padding: 8px 12px;
            border-radius: 4px;
            width: 100%;
            margin: 8px 0;
        }
        button.action-btn {
            background: #3B82F6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 4px 4px 4px 0;
            transition: all 0.2s;
        }
        button.action-btn:hover {
            background: #2563EB;
        }
        .journey-item {
            background: #262626;
            padding: 8px 12px;
            margin: 4px 0;
            border-radius: 4px;
            font-size: 0.875rem;
        }
        .journey-item .time {
            color: #A1A1A1;
        }
        .journey-item .url {
            color: #22C55E;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üçõ ClickChutney SPA Demo</h1>
        <p>Demonstrating Single Page Application tracking, session management, and UTM parameter capture</p>
        
        <div class="badge">Phase 2 Features</div>
        <div class="badge">SPA Tracking</div>
        <div class="badge">Session Management</div>
        <div class="badge">UTM Capture</div>
    </div>

    <div class="container">
        <aside class="sidebar">
            <h3>üß≠ Navigation</h3>
            <p>Click these buttons to simulate SPA navigation:</p>
            <ul class="nav-menu">
                <li><button onclick="navigateTo('/', 'Home')">üè† Home</button></li>
                <li><button onclick="navigateTo('/dashboard', 'Dashboard')">üìä Dashboard</button></li>
                <li><button onclick="navigateTo('/analytics', 'Analytics')">üìà Analytics</button></li>
                <li><button onclick="navigateTo('/projects', 'Projects')">üìÅ Projects</button></li>
                <li><button onclick="navigateTo('/settings', 'Settings')">‚öôÔ∏è Settings</button></li>
                <li><button onclick="navigateTo('/profile', 'Profile')">üë§ Profile</button></li>
            </ul>

            <h3>üéØ Custom Events</h3>
            <button class="action-btn" onclick="trackCustomEvent()">Track Custom Event</button>
            <button class="action-btn" onclick="identifyUser()">Identify User</button>
            <button class="action-btn" onclick="sendHeartbeat()">Send Heartbeat</button>

            <h3>üîó UTM Testing</h3>
            <p>Test UTM parameter capture:</p>
            <input type="text" class="url-input" id="utmUrl" placeholder="Add UTM parameters..." value="?utm_source=demo&utm_medium=test&utm_campaign=spa_demo">
            <button class="action-btn" onclick="simulateUtmVisit()">Simulate UTM Visit</button>
        </aside>

        <main class="content">
            <div id="page-content">
                <h2>Welcome to the SPA Demo</h2>
                <p>This page demonstrates ClickChutney's Phase 2 features for Single Page Application tracking and session management.</p>
                <p>Navigate using the sidebar to see real-time SPA route change detection in action!</p>
            </div>

            <div class="status-panel" id="session-status">
                <h3>üìä Session Status</h3>
                <div id="session-info">Initializing...</div>
            </div>

            <div class="status-panel" id="journey-status">
                <h3>üó∫Ô∏è User Journey</h3>
                <div id="journey-info">No pages visited yet</div>
            </div>

            <div class="status-panel" id="utm-status">
                <h3>üéØ UTM Parameters</h3>
                <div id="utm-info">No UTM parameters detected</div>
            </div>

            <div class="status-panel" id="events-log">
                <h3>üìù Recent Events</h3>
                <div id="events-info">No events tracked yet</div>
            </div>
        </main>
    </div>

    <!-- ClickChutney Analytics Script -->
    <script>
        // Initialize analytics queue
        (function() {
            window.cc = window.cc || function() {
                (window.cc.q = window.cc.q || []).push(arguments);
            };
            
            var script = document.createElement('script');
            script.async = true;
            script.src = '/clickchutney-analytics.js';
            script.onload = function() {
                console.log('ClickChutney Analytics loaded successfully!');
                initializeDemo();
            };
            script.onerror = function() {
                console.error('Failed to load ClickChutney Analytics script');
            };
            document.head.appendChild(script);
        })();

        // Initialize ClickChutney with SPA features enabled
        cc('init', {
            trackingId: 'cc_spa_demo_id',
            debug: true,
            autoPageview: true,
            enableSPATracking: true,
            trackUtmParams: true,
            trackReferrers: true
        });

        // Demo state
        let currentPage = '/';
        let eventCount = 0;
        let recentEvents = [];

        // Page content for different routes
        const pages = {
            '/': {
                title: 'Home',
                content: `
                    <h2>üè† Home Page</h2>
                    <p>Welcome to the ClickChutney SPA Demo home page!</p>
                    <p>This page simulates a typical SPA home page with navigation tracking.</p>
                `
            },
            '/dashboard': {
                title: 'Dashboard', 
                content: `
                    <h2>üìä Dashboard</h2>
                    <p>Analytics dashboard with real-time metrics and insights.</p>
                    <p>Page view and user behavior tracking is active.</p>
                `
            },
            '/analytics': {
                title: 'Analytics',
                content: `
                    <h2>üìà Analytics</h2>
                    <p>Deep dive into your website analytics and performance metrics.</p>
                    <p>Track user engagement, conversion rates, and more.</p>
                `
            },
            '/projects': {
                title: 'Projects',
                content: `
                    <h2>üìÅ Projects</h2>
                    <p>Manage your analytics projects and tracking configurations.</p>
                    <p>View project statistics and manage tracking IDs.</p>
                `
            },
            '/settings': {
                title: 'Settings',
                content: `
                    <h2>‚öôÔ∏è Settings</h2>
                    <p>Configure your analytics preferences and account settings.</p>
                    <p>Manage privacy settings and data retention policies.</p>
                `
            },
            '/profile': {
                title: 'Profile',
                content: `
                    <h2>üë§ Profile</h2>
                    <p>View and edit your user profile information.</p>
                    <p>Update your preferences and notification settings.</p>
                `
            }
        };

        function initializeDemo() {
            updateSessionStatus();
            updateJourneyStatus();
            updateUtmStatus();
            
            // Update status every 2 seconds
            setInterval(updateSessionStatus, 2000);
            setInterval(updateJourneyStatus, 2000);
        }

        function navigateTo(path, title) {
            // Update active navigation
            document.querySelectorAll('.nav-menu button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Simulate SPA navigation
            currentPage = path;
            const pageData = pages[path] || pages['/'];
            
            // Update page content
            document.getElementById('page-content').innerHTML = pageData.content;
            document.title = `${pageData.title} - ClickChutney SPA Demo`;
            
            // Update URL without page reload
            history.pushState({ page: path, title: pageData.title }, pageData.title, path);
            
            // ClickChutney will automatically detect this route change and track it
            console.log(`Navigated to: ${path}`);
            
            logEvent(`Navigation to ${path}`, { page: path, title: pageData.title });
        }

        function trackCustomEvent() {
            const eventData = {
                action: 'button_click',
                element: 'custom_event_button',
                page: currentPage,
                timestamp: Date.now()
            };
            
            cc('event', 'custom_action', eventData);
            logEvent('Custom Event Tracked', eventData);
        }

        function identifyUser() {
            const userId = 'demo_user_' + Math.random().toString(36).substr(2, 9);
            const traits = {
                name: 'SPA Demo User',
                email: 'demo@spa-test.com',
                plan: 'demo',
                signup_date: new Date().toISOString()
            };
            
            cc('identify', userId, traits);
            logEvent('User Identified', { userId, traits });
        }

        function sendHeartbeat() {
            if (window.ClickChutney && window.ClickChutney.heartbeat) {
                window.ClickChutney.heartbeat();
                logEvent('Heartbeat Sent', { timestamp: Date.now() });
            }
        }

        function simulateUtmVisit() {
            const utmParams = document.getElementById('utmUrl').value;
            const newUrl = window.location.pathname + utmParams;
            
            // Update URL with UTM parameters
            history.pushState({}, '', newUrl);
            
            // Trigger a pageview to capture the UTM parameters
            cc('pageview', currentPage, `${pages[currentPage]?.title} - UTM Test`);
            
            logEvent('UTM Visit Simulated', { url: newUrl, params: utmParams });
            
            setTimeout(updateUtmStatus, 500);
        }

        function updateSessionStatus() {
            if (!window.ClickChutney || !window.ClickChutney._session) {
                document.getElementById('session-info').innerHTML = 'ClickChutney not loaded yet...';
                return;
            }
            
            const session = window.ClickChutney._session;
            const duration = Date.now() - session.startTime;
            const sessionHtml = `
                <strong>Session ID:</strong> ${session.id?.slice(-8)}...<br>
                <strong>Duration:</strong> ${Math.floor(duration / 1000)}s<br>
                <strong>Pageviews:</strong> ${session.pageviews}<br>
                <strong>Landing Page:</strong> ${session.landingPage || 'N/A'}<br>
                <strong>Referrer:</strong> ${session.referrer || 'Direct'}
            `;
            document.getElementById('session-info').innerHTML = sessionHtml;
        }

        function updateJourneyStatus() {
            if (!window.ClickChutney || !window.ClickChutney._session) return;
            
            const journey = window.ClickChutney._session.userJourney || [];
            if (journey.length === 0) {
                document.getElementById('journey-info').innerHTML = 'No pages in journey yet';
                return;
            }
            
            const journeyHtml = journey.slice(-5).map(entry => `
                <div class="journey-item">
                    <div class="url">${entry.url || 'Unknown'}</div>
                    <div class="time">${new Date(entry.timestamp).toLocaleTimeString()}</div>
                </div>
            `).join('');
            
            document.getElementById('journey-info').innerHTML = journeyHtml;
        }

        function updateUtmStatus() {
            if (!window.ClickChutney || !window.ClickChutney._session) return;
            
            const utmParams = window.ClickChutney._session.utmParams || {};
            if (Object.keys(utmParams).length === 0) {
                document.getElementById('utm-info').innerHTML = 'No UTM parameters detected';
                return;
            }
            
            const utmHtml = Object.entries(utmParams).map(([key, value]) => `
                <strong>${key}:</strong> ${value}<br>
            `).join('');
            
            document.getElementById('utm-info').innerHTML = utmHtml;
        }

        function logEvent(event, data) {
            eventCount++;
            const timestamp = new Date().toLocaleTimeString();
            recentEvents.unshift({ event, data, timestamp });
            
            // Keep only last 5 events
            if (recentEvents.length > 5) {
                recentEvents = recentEvents.slice(0, 5);
            }
            
            const eventsHtml = recentEvents.map(item => `
                <div class="journey-item">
                    <div class="url">${item.event}</div>
                    <div class="time">${item.timestamp}</div>
                </div>
            `).join('');
            
            document.getElementById('events-info').innerHTML = eventsHtml;
        }

        // Handle browser back/forward
        window.addEventListener('popstate', function(event) {
            if (event.state && event.state.page) {
                const pageData = pages[event.state.page] || pages['/'];
                document.getElementById('page-content').innerHTML = pageData.content;
                document.title = `${pageData.title} - ClickChutney SPA Demo`;
                currentPage = event.state.page;
            }
        });

        // Initial page state
        history.replaceState({ page: '/', title: 'Home' }, 'Home', '/');
    </script>
</body>
</html>